<Window x:Class="OmniArmory.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:shared="clr-namespace:OmniArmory.Shared;assembly=OmniArmory.Shared"
        mc:Ignorable="d"
        Title="OmniArmory" Height="600" Width="900"
        Background="#202020" Foreground="#E0E0E0">

    <Window.Resources>
        <!-- Style for TreeViewItem to handle selection and expanded states visually -->
        <Style TargetType="TreeViewItem">
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay, FallbackValue=True}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Padding" Value="2"/>
        </Style>

        <!-- DataTemplate for DirectoryNode -->
        <HierarchicalDataTemplate DataType="{x:Type shared:DirectoryNode}" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal" Margin="2">
                <!-- Folder Name -->
                <TextBlock Text="{Binding Name}" Foreground="Cyan" FontWeight="SemiBold"/>
                
                <!-- Stats: [F: 10 (T: 50) | D: 2 (T: 5)] -->
                <TextBlock Margin="8,0,0,0" Foreground="Gray" FontSize="11" VerticalAlignment="Center">
                    <Run Text="[" Foreground="DarkGray"/>
                    <Run Text="F:" Foreground="Gray"/>
                    <Run Text="{Binding Stats.DirectFileCount, Mode=OneWay}" Foreground="#D0D0D0"/>
                    <Run Text="(T:" Foreground="Gray"/>
                    <Run Text="{Binding Stats.DeepFileCount, Mode=OneWay}" Foreground="#D0D0D0"/>
                    <Run Text=")" Foreground="Gray"/>
                    <Run Text=" | " Foreground="DarkGray"/>
                    <Run Text="D:" Foreground="Gray"/>
                    <Run Text="{Binding Stats.DirectDirCount, Mode=OneWay}" Foreground="#D0D0D0"/>
                    <Run Text="(T:" Foreground="Gray"/>
                    <Run Text="{Binding Stats.DeepDirCount, Mode=OneWay}" Foreground="#D0D0D0"/>
                    <Run Text=")" Foreground="Gray"/>
                    <Run Text="]" Foreground="DarkGray"/>
                </TextBlock>

                <!-- Tags -->
                <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" FontSize="11">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Stats.IsAccessDenied}" Value="True">
                                    <Setter Property="Text" Value="[! Access Denied]"/>
                                    <Setter Property="Foreground" Value="Yellow"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>
        </HierarchicalDataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- TitleBar -->
            <RowDefinition Height="*"/>    <!-- MainContent -->
            <RowDefinition Height="Auto"/> <!-- StatusBar -->
        </Grid.RowDefinitions>

        <!-- TitleBar -->
        <Border Grid.Row="0" Background="#2D2D30" Padding="15,10">
            <Grid>
                <TextBlock Text="OmniArmory" Foreground="White" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
                <Button Content="Select Folder" HorizontalAlignment="Right" Padding="10,2" 
                        Click="SelectFolder_Click" Background="#3E3E42" Foreground="White" BorderBrush="#555555"/>
            </Grid>
        </Border>

        <!-- MainContent (Drop Zone & TreeView) -->
        <Grid Grid.Row="1" Background="#1E1E1E" AllowDrop="True" Drop="Grid_Drop" DragOver="Grid_DragOver">
            
            <!-- Drop Hint (Visible when no data) -->
            <Border x:Name="DropZone" BorderBrush="#444" BorderThickness="2" CornerRadius="10" 
                    Margin="20" Background="Transparent" IsHitTestVisible="False">
                <Border.Style>
                    <Style TargetType="Border">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasData}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“‚" FontSize="48" HorizontalAlignment="Center" Foreground="#555"/>
                    <TextBlock Text="Drag &amp; Drop Folder Here" FontSize="18" Foreground="#666" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <!-- TreeView -->
            <TreeView x:Name="ResultTree" Background="Transparent" BorderThickness="0" Margin="5"
                      VirtualizingStackPanel.IsVirtualizing="True"
                      VirtualizingStackPanel.VirtualizationMode="Recycling"
                      SelectedItemChanged="ResultTree_SelectedItemChanged"
                      Visibility="Collapsed"> <!-- Visibility controlled by code-behind or triggers -->
            </TreeView>
            
        </Grid>

        <!-- StatusBar -->
        <StatusBar Grid.Row="2" Background="#007ACC" Foreground="White">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Ready"/>
            </StatusBarItem>
            <Separator Background="#33FFFFFF"/>
            <StatusBarItem>
                <TextBlock x:Name="DetailText" Text=""/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
